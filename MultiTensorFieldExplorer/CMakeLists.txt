cmake_minimum_required(VERSION 2.6)
project(MultiTensorFieldExplorer)

find_package(OpenCV REQUIRED)
file(GLOB SRC_CPP "src/*.cpp")
file(GLOB INCLUDES "include/*.h")
IF(USE_QT)
	add_definitions( -DUSE_QT)
	find_package(Qt4 REQUIRED)
	FIND_PACKAGE(OpenGL REQUIRED)
	IF(NOT QT4_FOUND)
		message(SEND_ERROR "Failed to find Qt4 ")
	ELSE(NOT QT4_FOUND)
		set(QT_USE_QTMAIN 1)
		set(QT_USE_QTOPENGL 1)
		include(${QT_USE_FILE})
	ENDIF(NOT QT4_FOUND)
	file(GLOB QT_SRC_CPP "src/qt/*.cpp")
	set(SRC_CPP ${SRC_CPP} ${QT_SRC_CPP})
	file(GLOB QT_INCLUDES_CPP "include/qt/*.h")
	set(INCLUDES ${INCLUDES} ${QT_INCLUDES_CPP})
	include_directories(./include/qt)
	include_directories(${CMAKE_BINARY_DIR}/MultiTensorFieldExplorer)
	SET(QT_USE_QTOPENGL TRUE)
	file(GLOB MultiTensorFieldExplorer_UIS *.ui)
	file(GLOB MultiTensorFieldExplorer_MOC_Headers 
		./include/qt/multitensorfieldexplorer.h
		./include/qt/glviewer.h)
	QT4_WRAP_UI(MultiTensorFieldExplorer_UI_Source ${MultiTensorFieldExplorer_UIS})
	QT4_WRAP_CPP(MultiTensorFieldExplorer_MOC_Source ${MultiTensorFieldExplorer_MOC_Headers})
	SOURCE_GROUP("Generated Files" REGULAR_EXPRESSION /*.cxx$)
	SOURCE_GROUP("Resource Files" REGULAR_EXPRESSION /*.qrc$)
	SOURCE_GROUP("UI Files" REGULAR_EXPRESSION /*.ui$)
ENDIF(USE_QT)
option(RUN_LOSS_ANALYSIS "Run quality loss vs. sparsity analysis?" OFF)
option(DBF_DEBUG "Print DBF debugging messages?" OFF)

if(RUN_LOSS_ANALYSIS)
	add_definitions(-DRUN_LOSS_ANALYSIS)
endif(RUN_LOSS_ANALYSIS)
if(DBF_DEBUG)
	add_definitions(-DDBF_DEBUG)
endif(DBF_DEBUG)
IF (WIN32)

ELSE (WIN32)
	set(GL_INCLUDE_DIR "/usr/X11/include/")
	include_directories(${GL_INCLUDE_DIR}) 
ENDIF (WIN32)
include_directories(${OpenCV_INCLUDE_DIRS})
include_directories(.)
include_directories(${CLAPACK_INCLUDE_DIR})
link_directories(${CLAPACK_LIBRARY_DIR})
link_directories(${OPENCV_LIBRARY_DIR})
#message(STATUS "CPPs: ${SRC_CPP}")
add_executable(MultiTensorFieldExplorer ${SRC_CPP} ${INCLUDES} ${MultiTensorFieldExplorer_UI_Source} ${MultiTensorFieldExplorer_MOC_Source})
set(DEPENDENCIES niftiio znz zlib NNLibrary HARDILib procimlib imageiolib dimreductionlib sparselib timelib)
IF(USE_GSL)
message(STATUS "Using GSL")
set(DEPENDENCIES ${DEPENDENCIES} ${GSL_LIBRARIES})
ENDIF(USE_GSL)
IF(USE_ARPACK)
message(STATUS "Using ARPACK")
set(DEPENDENCIES ${DEPENDENCIES} ${ARPACK_LIBRARY})
ENDIF(USE_ARPACK)
IF(USE_QT)
message(STATUS "Using Qt")
set(DEPENDENCIES ${DEPENDENCIES} ${QT_LIBRARIES} ${OPENGL_glu_LIBRARY} ${OPENGL_gl_LIBRARY})
ENDIF(USE_QT)

target_link_libraries(MultiTensorFieldExplorer ${DEPENDENCIES} ${OpenCV_LIBS} ${CLAPACK_LIBS})


INSTALL(TARGETS MultiTensorFieldExplorer
    RUNTIME DESTINATION ${ANURA_INSTALL_BIN_DIR} COMPONENT RuntimeLibraries
    LIBRARY DESTINATION ${ANURA_INSTALL_LIB_DIR} COMPONENT RuntimeLibraries
    ARCHIVE DESTINATION ${ANURA_INSTALL_LIB_DIR} COMPONENT Development)
